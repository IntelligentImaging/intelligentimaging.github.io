/* Copyright © 2004-2015 Trumba Corporation. All rights reserved. */
if(typeof($Trumba)=="undefined"){window.$Trumba={version:3,loadTime:new Date(),emptyFunction:function(){},baseUri:"",loaderUri:"s.aspx",busyImageUri:"images/spinner_trumba.gif",showDebugOutput:((typeof(trumba_showDebugOutput)!="undefined")&&trumba_showDebugOutput),prologQueue:[],iframeBgColor:"transparent"};(function(){var a=document.getElementsByTagName("script");var d="";for(var c=0;c<a.length;c++){var f=a[c].src;var b=f?f.match(/\/scripts\/(_?spuds|embed)\.js(.*)?$/i):null;if(b){$Trumba.isHosted2=(a[c].getAttribute("hosted2")=="true");d=b.input.substring(0,b.index+1);d=d.replace(/\/hash[0-9a-f]+\//i,"/");if(d[0]=="/"){d=document.location.protocol+d}break}}$Trumba.baseUri=d;$Trumba.loaderUri=d+$Trumba.loaderUri;$Trumba.busyImageUri=d+$Trumba.busyImageUri})();$Trumba.Class={create:function(){return function(){this.initialize.apply(this,arguments)}},extend:function(a,b){for(property in b){a[property]=b[property]}return a},addNamespace:function(d){var c=d.split(".");var a=window;for(var b=0;b<c.length;b++){if(a[c[b]]==null){a[c[b]]={}}a=a[c[b]]}}};$Trumba.Try={these:function(){var c;for(var b=0;b<arguments.length;b++){var a=arguments[b];try{c=a();break}catch(d){}}return c}};$Trumba.$=function(d){var a=[];for(var c=0;c<arguments.length;c++){var b=arguments[c];if(typeof(b)=="string"){b=document.getElementById(b)}a.push(b)}if(a.length==1){return a[0]}return a};Function.prototype.$trumba_bind=function(){var a=this,c=$Trumba.$A(arguments),b=$Trumba.Array.shift(c);return function(){return a.apply(b,c.concat($Trumba.$A(arguments)))}};$Trumba.Class.addNamespace("$Trumba.Array");$Trumba.Array.shift=function(b){var a=b[0];for(var c=0;c<b.length-1;c++){b[c]=b[c+1]}b.length--;return a};$Trumba.Array.$break={};$Trumba.Array.$continue={};$Trumba.Array.each=function(f,c){var a=0;f=f||[];try{for(var b=0;b<f.length;b++){try{c(f[a],a++)}catch(d){if(d!=$Trumba.Array.$continue){throw d}}}}catch(d){if(d!=$Trumba.Array.$break){throw d}}};$Trumba.$A=function(c){if(!c){return[]}if(c.toArray){return c.toArray()}else{var b=[];for(var a=0;a<c.length;a++){b.push(c[a])}return b}};$Trumba.escape=function(a){return encodeURIComponent(a).replace(new RegExp("\\+","g"),"%2B").replace(new RegExp('\\"',"g"),"%22").replace(new RegExp("\\'","g"),"%27").replace(new RegExp("\\/","g"),"%2F")};$Trumba.Class.addNamespace("$Trumba.String");$Trumba.String={fill:function(f,d){var a=new Array(d);for(var b=0;b<d;b++){a.push(f)}return a.join("")},format:function(){if(arguments.length<=1){return(arguments.length==1)?arguments[0]:""}var a=arguments[0];for(var b=1;b<arguments.length;b++){a=a.replace(new RegExp("\\{"+(b-1)+"}","g"),arguments[b])}return a}};$Trumba.Event={};$Trumba.Class.extend($Trumba.Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},keyCode:function(a){if(a.charCode){return a.keyCode>0?a.keyCode:a.charCode}return a.keyCode},isAltKey:function(a){return(a.altKey&&a.altKey)||false},isShiftKey:function(a){return(a.shiftKey&&a.shiftKey)||false},isCtrlKey:function(a){return(a.ctrlKey&&a.ctrlKey)||false},isLeftClick:function(a){return(((a.which)&&(a.which==1))||((a.button)&&(a.button==1)))},pointerX:function(a){return a.pageX||(a.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft))},pointerY:function(a){return a.pageY||(a.clientY+(document.documentElement.scrollTop||document.body.scrollTop))},stop:function(a){if(a.preventDefault){a.preventDefault();a.stopPropagation()}else{a.returnValue=false;a.cancelBubble=true}},findElement:function(c,b){var a=$Trumba.Event.element(c);while(a.parentNode&&(!a.tagName||(a.tagName.toUpperCase()!=b.toUpperCase()))){a=a.parentNode}return a},observers:false,_observeAndCache:function(d,c,b,a){if(!this.observers){this.observers=[]}if(d.addEventListener){this.observers.push([d,c,b,a]);d.addEventListener(c,b,a)}else{if(d.attachEvent){this.observers.push([d,c,b,a]);d.attachEvent("on"+c,b)}}},observe:function(d,c,b,a){var d=$Trumba.$(d);a=a||false;if(c=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||d.attachEvent)){c="keydown"}this._observeAndCache(d,c,b,a)},stopObserving:function(f,c,b,a){var f=$Trumba.$(f);a=a||false;var g=null;try{g=f.tagName||f.location}catch(d){}if(g){if(c=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||f.detachEvent)){c="keydown"}if(f.removeEventListener){f.removeEventListener(c,b,a)}else{if(f.detachEvent){f.detachEvent("on"+c,b)}}}}});$Trumba.EventSource={_eventSource_events:false,addEventListener:function(b,a){if(b){b=b.toLowerCase()}if(b&&a){if(!this._eventSource_events){this._eventSource_events={}}if(typeof(this._eventSource_events[b])=="undefined"){this._eventSource_events[b]=[]}for(var c=0;c<this._eventSource_events[b].length;c++){if(this._eventSource_events[b][c]==a){return}}this._eventSource_events[b].push(a)}},removeEventListener:function(b,a){if(b){b=b.toLowerCase()}if(b&&a){if(!this._eventSource_events){return}if(typeof(this._eventSource_events[b])=="undefined"){return}var d=[];for(var c=0;c<this._eventSource_events[b].length;c++){if(this._eventSource_events[b][c]!=a){d.push(this._eventSource_events[b][c])}}if(d.length>0){this._eventSource_events[b]=d}else{this._eventSource_events[b]=null;delete this._eventSource_events[b]}}},_fireEvent:function(b){if(b){b=b.toLowerCase()}var a=$Trumba.$A(arguments);a.shift();if(this._eventSource_events[b]){for(var d=0;d<this._eventSource_events[b].length;d++){try{this._eventSource_events[b][d].apply(window,a)}catch(c){}}}}};$Trumba.Logger=$Trumba.Class.create();$Trumba.Logger.LEVEL_ERROR=1;$Trumba.Logger.LEVEL_WARNING=2;$Trumba.Logger.LEVEL_INFO=3;$Trumba.Logger.prototype={initialize:function(){this.handlers=[]},addHandler:function(b){if(b){for(var a=0;a<this.handlers.length;a++){if(this.handlers[a]==b){return}}this.handlers.push(b)}},removeHandler:function(c){if(c&&this.handlers.length>0){var a=[];for(var b=0;b<this.handlers.length;b++){if(this.handlers[b]==c){continue}a[a.length]==this.handlers[b]}this.handlers=a}},_log:function(h,g,f,d,b){if(!this.handlers.length){return}var a={};a.level=h;a.message=g;a.thrown=f;a.className=d;a.methodName=b;for(var c=0;c<this.handlers.length;c++){this.handlers[c].processRecord(a)}},error:function(a){this._log.apply(this,[$Trumba.Logger.LEVEL_ERROR].concat($Trumba.$A(arguments)))},warning:function(a){this._log.apply(this,[$Trumba.Logger.LEVEL_WARNING].concat($Trumba.$A(arguments)))},info:function(a){this._log.apply(this,[$Trumba.Logger.LEVEL_INFO].concat($Trumba.$A(arguments)))}};$Trumba.logger=new $Trumba.Logger();$Trumba.Debug={};$Trumba.Debug.ConsoleLogger=$Trumba.Class.create();$Trumba.Debug.ConsoleLogger.prototype={initialize:function(){if($Trumba.Debug.ConsoleLogger.init){return}if(typeof(console)=="undefined"||typeof(console.log)=="undefined"){return}this._methods={};this._methods[$Trumba.Logger.LEVEL_INFO]=console.log;this._methods[$Trumba.Logger.LEVEL_WARNING]=console.warn||console.log;this._methods[$Trumba.Logger.LEVEL_ERROR]=console.error||console.log;$Trumba.Debug.ConsoleLogger.init=$Trumba.Debug.ConsoleLogger.init||true;$Trumba.logger.addHandler(this)},_getMethod:function(a){return this._methods[a.level]||function(){}},processRecord:function(a){var b="";b=b.length>4?b:"";this._getMethod(a).apply(console,[b+a.message])}};if($Trumba.showDebugOutput){new $Trumba.Debug.ConsoleLogger()}$Trumba.Class.addNamespace("$Trumba.Net");$Trumba.Net.QueryString=$Trumba.Class.create();$Trumba.Net.QueryString.prototype={initialize:function(a){this.pairs=[];if(a!=null){if(typeof(a)=="string"){this.from(a)}else{if(typeof(a)=="object"){this.copyConstructor(a)}}}},copyConstructor:function(a){var b=this;a.visit(function(d,c){b.setAt(d,c)})},from:function(c){this.pairs=[];if(c==null||c==""){return}if(c.indexOf("?")==0){c=c.substring(1)}c=c.split("&");for(var b=0;b<c.length;b++){if(c[b]!=""){var a=c[b].split("=");if(a.length==1){this.pairs.push([decodeURIComponent(a[0]),null])}else{this.pairs.push([decodeURIComponent(a[0]),decodeURIComponent(a[1])])}}}},isEmpty:function(){return this.pairs.length==0},getCount:function(){return this.pairs.length},setAt:function(a,c){var b=this.findByName(a);if(b!=-1){this.pairs[b][1]=c}else{this.pairs.push([a,c])}},toString:function(){var b=new Array(this.pairs.length);for(var a=0;a<b.length;a++){if(this.pairs[a][1]==null){b[a]=$Trumba.escape(this.pairs[a][0])}else{b[a]=$Trumba.escape(this.pairs[a][0])+"="+$Trumba.escape(this.pairs[a][1])}}return b.join("&")},getAt:function(a){if(typeof(a)=="string"){a=this.findByName(a);if(a==-1){return null}}return this.pairs[a]},getValue:function(a){var b=this.getAt(a);return b&&b.length==2?b[1]:null},remove:function(b){var a=this.findByName(b);if(a!=-1){this.removeAt(a)}},removeAt:function(b){var a=[];for(var c=0;c<this.pairs.length;c++){if(c!=b){a.push(this.pairs[c])}}this.pairs=a},length:function(){return this.pairs.length},visit:function(a){for(var b=0;b<this.pairs.length;b++){a(this.pairs[b][0],this.pairs[b].length>1?this.pairs[b][1]:null)}},findByName:function(a){for(var b=0;b<this.pairs.length;b++){if(this.pairs[b][0]==a){return b}}return -1},insert:function(a){for(var b=0;b<a.length();b++){var c=a.getAt(b);this.setAt(c[0],c[1])}},subtract:function(a){for(var b=0;b<a.length();b++){var b=this.findByName(a.getAt(b)[0]);if(b!=-1){this.removeAt(b)}}},prefixWith:function(b){for(var a=0;a<this.pairs.length;a++){this.pairs[a][0]=b+this.pairs[a][0]}}};$Trumba.Net.Url=$Trumba.Class.create();$Trumba.Net.Url.prototype={initialize:function(a){this._path="";this._queryString=new $Trumba.Net.QueryString();this._hash="";if(a!=null){if(typeof(a)=="string"){this.fromString(a)}else{if(a.href){this.fromString(a.href)}else{if(typeof(a)=="object"){this.copyConstructor(search)}}}}},copyConstructor:function(a){this._path=a._path;this._queryString=new $Trumba.Net.QueryString(a._queryString);this._hash=a._hash},fromString:function(a){this._path="";this._queryString=new $Trumba.Net.QueryString();this._hash="";var b=a.indexOf("#");if(b>=0){this._hash=a.substring(b+1);a=a.substring(0,b)}b=a.indexOf("?");if(b>=0){this._queryString=new $Trumba.Net.QueryString(a.substring(b));a=a.substring(0,b)}this._path=a},getPath:function(){return this._path},getHash:function(){return this._hash},getQueryString:function(){return this._queryString},toString:function(){var b=this._path;var a=this._queryString.toString();if(a.length){b+="?"+a}if(this._hash.length){b+="#"+this._hash}return b}};$Trumba.Class.addNamespace("$Trumba.DOM");$Trumba.DOM={createElement:function(a,b){b=b||[];var d=document.createElement(a);for(var c=0;c<b.length;c++){if(b[c][1]!=""){d.setAttribute(b[c][0],b[c][1])}}return d},compareElements:function(d,c){if(d==c){return true}if(!d||!c){return false}if(d.tagName!=c.tagName){return false}if(d.attributes.length!=c.attributes.length){return false}for(var b=0;b<d.attributes.length;b++){var a=d.attributes[b].name;if(c.attributes[a]==null){return false}if(d.attributes[a].value!=c.attributes[a].value){return false}}return true},appendChild:function(c,d){var a=d.getElementsByTagName(c.tagName)||[];for(var b=0;b<a.length;b++){if($Trumba.DOM.compareElements(c,a[b])){return}}d.appendChild(c)}};$Trumba.Class.addNamespace("$Trumba.Spuds");$Trumba.Spuds.nextSpudID=0;$Trumba.Spuds.createSpudId=function(){return"trumba.spud."+$Trumba.Spuds.nextSpudID++};$Trumba.Spuds.supportsLocalStorage=function(){try{return typeof window.localStorage!="undefined"&&typeof window.JSON!="undefined"}catch(a){return false}};$Trumba.addSpud=function(k){var g=k.webName;if(!g||g==""){var d="ERROR : You must provide a webName parameter for your Spud!";alert(d);throw d}delete k.webName;var f=k.spudType;if(!f||f==""){var d="ERROR : You must provide a spudType parameter for your Spud!";alert(d);throw d}if(f.toLowerCase()=="calendar"){f="main"}if(f!="main"&&/googlebot/i.test(navigator.userAgent)){return}delete k.spudType;var p=k.spudId;if(p){delete k.spudId}var o=k.url;if(o){delete k.url}var b=k.objectType;if(b){if(!o){o={}}o.objecttype=b}var n=k.detectMobile;if(n!=null){if(!o){o={}}o.detectMobile=n}if((/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent))){if(!o){o={}}o.ismobile="1"}k.usexhr=true;var j=k;$Trumba.logger.info("Creating "+f+" for calendar "+g,null,"$Trumba","addSpud");var l=p?false:true;if(l){p=$Trumba.Spuds.createSpudId();if(k.position){k.position.removeOnClose=true;var a=document.createElement("div");a.id=p;a.style.position="absolute";a.style.zIndex=100000;a.style.backgroundColor=k.backgroundColor||"transparent";document.body.appendChild(a)}else{var m=f==="main"?'role="region" aria-live="polite"':"";var h=$Trumba.String.format('<div id="{0}" {1}></div>',p,m);document.write(h)}}var c=function(){var q=$Trumba.Spuds.SpudFactory.create(g,f,p,o,j);$Trumba.Spuds.controller.addSpud(q)};if($Trumba.$(p)==null){window.setTimeout(function(){if($Trumba.$(p)==null){$Trumba.logger.error("Cannot find our spud div with id "+p,null,null,"$Trumba.addSpud");return}c()},1);return p}c();return p};$Trumba.showWindow=function(a,d,b){var c=window.open(a,d,b);if(c){c.focus()}return c};$Trumba.Opera8Fixup=function(){window.trumba_opera_8_fix_1=document.getElementById("TrumbaIframe")};$Trumba.addBackCompatSpud=function(a,c,h,d,g){var f=$Trumba.$(g);if(!f){return}f.style.display="none";var b=$Trumba.DOM.createElement("div",[["id",""+Math.random()]]);f.parentNode.insertBefore(b,f);$Trumba.addSpud($Trumba.Class.extend({webName:a,spudType:c,spudId:b.id,url:h},d))};$Trumba.Spuds.renderIFrameHTML=function(g,f,d,a){a=a||"35";var b='height="'+a+'" ';if(d){if(typeof(d)=="number"){d=d+"px"}b+='width="'+d+'" '}var c=$Trumba.String.format('<iframe id="{0}" name="{0}" style="{1}" width="100%" scrolling="no" {2}>Please update your browser to view the iframe content.</iframe>',g,f||"",b,"");return c};$Trumba.Spuds.createIFrame=function(f,d,c,a){var b=document.createElement("iframe");b.setAttribute("id",f);b.setAttribute("name",f);b.setAttribute("width",c||"100%");if(a){b.setAttribute("height",a)}b.setAttribute("scrolling","no");if(d){b.setAttribute("style",d)}return b};$Trumba.Class.addNamespace("$Trumba.Spuds.SpudFactory");$Trumba.Spuds.SpudFactory.create=function(a,b,f,d,c){return new $Trumba.Spuds.SimpleSpud(a,b,f,d,c)};$Trumba.Spuds.removeList={eventid:{},view:{},objectid:{},objecttype:{},seotitle:{},key:{}};$Trumba.Spuds.TransientParams={_params:{calendar:{eventid:{},view:{},seriesid:{},parenteventid:{},objectid:{},objecttype:{},seotitle:{},key:{}},main:{eventid:{},view:{},seriesid:{},parenteventid:{},objectid:{},objecttype:{},seotitle:{},key:{}},mainobject:{eventid:{},view:{},seriesid:{},parenteventid:{},objectid:{},objecttype:{},seotitle:{},key:{}},"ryomain.*":{eventid:{},view:{},seriesid:{},parenteventid:{},objectid:{},objecttype:{},seotitle:{},key:{}}},getParams:function(a){for(var b in $Trumba.Spuds.TransientParams._params){var c=new RegExp(b,"i");if(c.test(a)){return $Trumba.Spuds.TransientParams._params[b]}}return{}}};$Trumba.Spuds.IFrameContainer=$Trumba.Class.create();$Trumba.Spuds.IFrameContainer.prototype={initialize:function(b,a){this._spud=a;this.parentDiv=b;this.id=b.id;this.iframeStyle=this._getDefaultStyle();this._position=this._spud.getProperty("position");this._initIFrame();this._loaded=false;if(this._position!=null){this.parentDiv.style.display="";this.parentDiv.style.position="absolute";this.parentDiv.style.left=this._position.left+"px";this.parentDiv.style.top=this._position.top+"px";this.parentDiv.style.width=this._position.width+"px";if(this._position.height){this.parentDiv.style.height=this._position.height+"px"}this.parentDiv.style.overflow="hidden";this.parentDiv.style.zIndex=100000;this.parentDiv.style.backgroundColor=this._spud.getProperty("backgroundColor")||"transparent";this.parentDiv.style.height="0px"}},_initIFrame:function(){var a=this._spud.getProperty("initialHeight")||35;var c="";if(!this._spud.getProperty("position")){c=$Trumba.String.format('<img id="{0}" src="{1}" width="16" height="16" style="width:16px;height:16px;border-width:0;margin:0" alt="Loading"></img>',this._spud._getBusyImageId(),$Trumba.busyImageUri)}var b=$Trumba.String.format('<div id="{0}" style="background-color:transparent;height:{1}px;padding:0px;">{2}</div>',this._getIFrameId(),a,c);this.parentDiv.innerHTML=b;this.iframe=$Trumba.$(this._getIFrameId())},_getDefaultStyle:function(){var a;try{a=this.parentDiv.style.backgroundColor||this.parentDiv.parentNode.style.backgroundColor||$Trumba.iframeBgColor}catch(b){a="transparent"}a=$Trumba.String.format("border-style:none;background-color:{0};",a);return a},close:function(){this.parentDiv.innerHTML="";this.parentDiv.style.display="none";if(this._position!=null&&this._position.removeOnClose){this.parentDiv.parentNode.removeChild(this.parentDiv);this.parentDiv=null}},setHTML:function(b,c){if(c){b=$Trumba.String.format("<html><body>{0}</body></html>",b)}var a={body:b};this._onDataSuccess(a);this._resizeIFrameWithWait(400)},onSpudLoaded:function(){$Trumba.logger.info(this._getIFrameId()+'<span style="color:red"> onSpudLoaded!</span>',null,"$Trumba.Spuds.IFrameContainer","onSpudLoaded");this._loaded=true;this._resizeIFrameWithWait();this._fireEvent("onFetched");this._spudLoaded()},_spudLoaded:function(){},resize:function(){this._resizeIFrame()},scrollIntoView:function(){var f=this.getLocation();if(f.top==0&&f.left==0){return}var a=window.innerHeight||document.documentElement.offsetHeight;var d=document.documentElement.scrollLeft||document.body.scrollLeft;var c=document.documentElement.scrollTop||document.body.scrollTop;var b=f.top-c;if(b>=0&&b<a){return}window.scrollTo(d,f.top)},cumulativeOffset:function(b){var a=0,c=0;do{a+=b.offsetTop||0;c+=b.offsetLeft||0;b=b.offsetParent}while(b);return[c,a]},getLocation:function(){if(this.iframe==null){return{left:0,top:0,width:0,height:0}}var a=this.cumulativeOffset(this.iframe);return{left:a[0],top:a[1],width:this.iframe.offsetWidth,height:this.iframe.offsetHeight}},getScroll:function(){var b={left:0,top:0};if(this.iframe==null){return b}for(var a=this.iframe.parentNode;a!=null&&a!=document.body;a=a.parentNode){b.top+=a.scrollTop||0;b.left+=a.scrollLeft||0}return b},getWindow:function(){if(this.iframe){if(this.iframe.contentWindow){return this.iframe.contentWindow}else{return window.frames[this._getIFrameId()]}}return null},fetch:function(d,c){this.queryString=d;c=c||{};var a=this;var b={onSuccess:this._onDataSuccess.$trumba_bind(this),onTimeout:c.onTimeout||this._onDataTimeout.$trumba_bind(this),onFailure:c.onFailure||this._onDataFailure.$trumba_bind(this),cbid:this.id};this._loaded=false;$Trumba.Spuds.controller.loader.request(this.queryString.toString(),b,{id:this.id,usexhr:this._spud.getProperty("usexhr")})},_getIFrameId:function(){return this.id+".iframe"},_resizeIFrameWithWait:function(b){var a=this;b=b||200;window.setTimeout(function(){a._resizeIFrame()},b)},_resizeIFrame:function(){if(!this._loaded||this._spud.closed){return}var f=this.iframe;var b=this;var d=(arguments.length==0);var a=f.height;var c=this._spud.properties.autoWidth;$Trumba.Try.these(function(){if(!/Safari/i.test(navigator.userAgent)&&f.contentDocument.body.offsetHeight>32000){f.height=32000;f.scrolling="yes"}else{f.height=f.contentDocument.body.offsetHeight}var g=f.contentDocument.getElementById("autoWidthRootDiv");if(c&&g){f.width=g.scrollWidth}else{if(g&&g.offsetWidth>f.offsetWidth){g.style.width=f.offsetWidth+"px"}}},function(){var g=f.Document.body.scrollHeight;if(g!=f.height){f.height=g}},function(){f.height=frames[f.id].document.body.scrollHeight;if(c){f.width=frames[f.id].document.body.scrollWidth}},function(){$Trumba.logger.warning(this._getIFrameId()+" Cannot figure out how to set IFRAME height!",null,"$Trumba.Spuds.IFrameContainer","_resizeIFrame");if(d){window.setTimeout(function(){b._resizeIFrame(false)},200)}});if(b._position!=null){b.parentDiv.style.height=f.height+"px"}this._spud._hideBusyImage();if(f.height!=a){this._sizeChanged()}if(this._position){this._fireEvent("resize",{left:this._position.left,top:this._position.top,width:this._position.width,height:parseInt(f.height)})}this._spud.setSpudCookieProperty("initialHeight",Number(f.height))},_sizeChanged:function(){if(this._position!=null){this.parentDiv.style.overflow="hidden";this.parentDiv.style.width=this._position.width+"px"}else{this.parentDiv.style.overflow="";this.parentDiv.style.width="";this.parentDiv.style.height=""}},getPosition:function(){return this._position},setPosition:function(a){if(!this._position){return}this._position.left=a.left||this._position.left;this._position.top=a.top||this._position.top;this._position.width=a.width||this._position.width;this.parentDiv.style.left=this._position.left+"px";this.parentDiv.style.top=this._position.top+"px";this.parentDiv.style.width=this._position.width+"px"},getIFrameDocument:function(a){if(a.contentDocument){return a.contentDocument}else{if(a.contentWindow){return a.contentWindow.document}else{if(a.document){return a.document}}}return null},_rebuildIFrame:function(c){if(this._spud.closed){$Trumba.logger.warning(this._getIFrameId()+"("+this.queryString.toString()+") Spud Closed - Not Rebuilding");return}var a=this.iframe.offsetHeight;var b=a;var d=this._spud.getProperty("initialHeight");if((a==0)&&(d!=null)){b=d}this.parentDiv.style.overflow="hidden";this.parentDiv.style.height=b+"px";if(this.iframe&&this.iframe.parentNode){this.parentDiv.removeChild(this.iframe)}this.iframe=null;this.parentDiv.innerHTML=$Trumba.Spuds.renderIFrameHTML(this._getIFrameId(),this.iframeStyle,null,a);this.iframe=$Trumba.$(this._getIFrameId());this.html=c;this._populateIFrame();if(this._spud.selfNavigate){this.iframe.focus()}},_populateIFrame:function(){if(!this.iframe){return}if(this.iframe.contentWindow){var c=this.iframe.contentWindow.document;this._writeAndClose(c,this.html);this._resizeIFrameWithWait()}else{if(window.frames){var d=this._getIFrameId();var a=this;var b=function(){if(!frames[d]){window.setTimeout(arguments.callee,1);return}a._writeAndClose(frames[d].document,this.html);a._resizeIFrameWithWait()};window.setTimeout(b,1)}else{$Trumba.logger.error("Ugh - no frames support, how did we get here?")}}},_onDataSuccess:function(a){this._rebuildIFrame(a)},_onDataTimeout:function(a){$Trumba.logger.error(this._getIFrameId()+" <b>Timeout Error</b> loading("+this.queryString.toString()+")");this.setHTML('<div style="font-style:italic;font-size:0.8em;font-family:Arial, Helvetica, Verdana;padding:10px;">Calendar is temporarily unavailable.</div>',true)},_onDataFailure:function(a){$Trumba.logger.error(this._getIFrameId()+" <b>Data Failure </b> loading("+this.queryString.toString()+")");var b=(typeof(a)==="undefined")?"Server":"Network";this.setHTML('<div style="font-style:italic;font-size:0.8em;font-family:Arial, Helvetica, Verdana;padding:10px;">'+b+" error loading calendar.</div>",true)},_writeAndClose:function(b,a){this._spud._hideBusyImage();if(b){b.write(a);b.close()}}};$Trumba.Class.extend($Trumba.Spuds.IFrameContainer.prototype,$Trumba.EventSource);$Trumba.Spuds.SimpleSpud=$Trumba.Class.create();$Trumba.Spuds.SimpleSpud.prototype={initialize:function(a,b,g,f,c){f=f||{};this.spudType=b;this.spudConfig=c.spudConfig||"";this.spudConfigSuffix=(this.spudConfig==""?"":("_"+this.spudConfig));this.id=g;this.webName=a;this._initProperties(c,f);this.setQueryString(this._getEmbedArguments(),f);this.selfNavigate=false;this.firstFetch=true;this.parentDiv=$Trumba.$(g);try{this.parentDiv.innerHTML="<div></div>"}catch(d){this._fixDivInsideInline()}this.container=new $Trumba.Spuds.IFrameContainer(this.parentDiv,this);this.container.addEventListener("onFetched",this.onFetched.$trumba_bind(this));if(this.getProperty("position")!=null){new $Trumba.Spuds.PopUpBehavior(this,this.getProperty("closeOnFocus"),this.getProperty("closeOnFocus"))}$Trumba.logger.info(this.getUniqueID()+" Created for "+a+"/"+b+" "+this.queryString.toString())},getSavedSpudProperties:function(d){var b={};var g=d+"_";var a=g.length;try{var f=window.localStorage.getItem("spudProperties_"+this.webName);if(f){var c=window.JSON.parse(f);for(var j in c){if(j.indexOf(g)==0){b[j.substring(a)]=c[j]}}}}catch(h){}return b},_initProperties:function(b,c){this.properties=b||{};var d;var a;if($Trumba.Spuds.supportsLocalStorage()){d=this.getSavedSpudProperties(this.spudType+this.spudConfigSuffix);$Trumba.Class.extend(this.properties,d)}if(c.objecttype){this.properties.ignoreCookie=true}if(c.preview){this.properties.ignoreCookie=true}if(this.getProperty("ignoreCookie")||this.getProperty("ignoreSavedSelections")){return}if($Trumba.Spuds.supportsLocalStorage()){d=this.getSavedSpudProperties("*");for(var f in d){if(0==f.indexOf("url.")){c[f.substring(4)]=d[f]}else{this.properties[f]=d[f]}}}},getPermalink:function(){var c=this.container.getWindow();if(c){var b=c.document;if(b){var a=b.getElementById("permaLink");if(a&&a.href){return a.href}}}return window.top.location.href},getEventSummary:function(){var a=this.container.getWindow();if(a&&a.eventSummary){return a.eventSummary}return null},setTitle:function(a){if(typeof(this.container.iframe)!="undefined"&&this.container.iframe!=null){this.container.iframe.setAttribute("title",a);if(this.container.parentDiv.getAttribute("role")=="region"){this.container.parentDiv.setAttribute("aria-label",a)}}},setSpudCookieProperty:function(a,d){var c=/^url\./i.test(a)?"*":this.spudType+this.spudConfigSuffix;if($Trumba.Spuds.supportsLocalStorage()){try{var b=JSON.parse(window.localStorage.getItem("spudProperties_"+this.webName));if(b==null){b={}}b[c+"_"+a]=d;window.localStorage.setItem("spudProperties_"+this.webName,window.JSON.stringify(b))}catch(f){}}},close:function(){if(this.closed){$Trumba.logger.info("ALREADY CLOSED:"+this.queryString.toString());return}$Trumba.logger.info("Closing Spud:"+this.queryString.toString());this._hideBusyImage();this.closed=true;this._fireEvent("close");this.container.close();$Trumba.Spuds.controller.removeSpud(this)},_fixDivInsideInline:function(){$Trumba.logger.warning("Spud container embedded in a "+this.parentDiv.parentNode.tagName.toUpperCase(),null,"$Trumba.Spuds.SimpleSpud","_fixDivInsideInline");var b=$Trumba.DOM.createElement("div",[["id",""+Math.random()]]);var c=this.parentDiv.parentNode;var a=false;while(!a&&c){var d=c.parentNode.insertBefore(b,c.nextSibling);try{d.innerHTML="<div></div>";a=true}catch(f){if(/BODY/i.test(c.tagName)){c==null}else{c=c.parentNode}}}if(!a){var g="We're sorry but you have placed your Trumba Spud inside of a "+c.tagName.toUpperCase()+" element which is not supported.  You must place it inside of a DIV.";alert(g);throw g}this.id=b.id;this.parentDiv=$Trumba.$(this.id)},onFetched:function(){var a=false;var h=this.container.getWindow();var g=h?h.document:null;if(h&&h.trumba_addStyleRules){var j=this.getProperty("styleRules");if(j&&j.length){h.trumba_addStyleRules(j);a=true}}if(h&&g){var f=this.getProperty("styleSheets");if(f&&f.length){var c=g.getElementsByTagName("head")[0];for(var b=0;b<f.length;b++){var d=g.createElement("link");d.setAttribute("href",f[b]);d.setAttribute("rel","stylesheet");c.appendChild(d)}g.body.style.visibility="visible"}}if(a){this.resize()}},onSpudLoaded:function(){this.container.onSpudLoaded()},_getEmbedArguments:function(){if($Trumba.isHosted2){var d=new $Trumba.Net.QueryString(location.search);d.remove("domainname");d.remove("local");return d}var c=new $Trumba.Net.QueryString(location.search);var a=c.getAt("trumbaEmbed");if(a==null||a.length==1){try{if(window.top.location.search!=location.search){c=new $Trumba.Net.QueryString(window.top.location.search);a=c.getAt("trumbaEmbed");if(a==null||a.length==1){return null}}else{return null}}catch(f){return null}}if(a[1]=="view=event"){var b=c.getAt("eventid");if(b!=null&&a.length>1){a[1]+="&eventid="+b[1]}}return new $Trumba.Net.QueryString(a[1])},getProperty:function(b){var a=this.properties[b];if(typeof(a)=="undefined"){a=null}return a},setProperty:function(a,b){this.properties[a]=b},getIFrameId:function(){if(this.container._getIFrameId){return this.container._getIFrameId()}return window.name},resize:function(){this.container.resize()},getQueryString:function(){return this.queryString.toString()},setQueryString:function(d,c){var a;if(c!=null){if(this.getProperty("lateAdd")){a=new $Trumba.Net.QueryString(d);for(var b in c){a.setAt(b,c[b])}}else{a=new $Trumba.Net.QueryString();for(var b in c){a.setAt(b,c[b])}a.insert(new $Trumba.Net.QueryString(d))}}else{a=new $Trumba.Net.QueryString(d)}a.setAt("calendar",this.webName);a.setAt("widget",this.spudType);if(this.spudConfig==""){a.removeAt("spudConfig",this.spudConfig)}else{a.setAt("spudConfig",this.spudConfig)}this.queryString=a},refresh:function(){this._fetchHTML()},navigate:function(b,q,n){var r=n;n=this.getProperty(n);if(q){$Trumba.logger.info(this.getUniqueID()+" abs navigate("+b+")");window.top.location.href=b}else{if(n&&n.length){$Trumba.logger.info(this.getUniqueID()+" base navigate("+n+" -- "+b+")");var g=this.queryString;this._mergeQueryString(b,true);var d=new $Trumba.Net.Url(n);var j=this.getProperty("openInNewWindow");if("detailBase"==r&&!j){var h=null;try{h=window.top.location.href}catch(o){}if(h){var a=new $Trumba.Net.QueryString(b);var l=new $Trumba.Net.Url(window.top.location);a.setAt("returnUrl",l.toString());b=a.toString()}}if(b!=""){var p=d.getQueryString();var f=p.getAt("trumbaEmbed");if(f){b=b?(f[1]+"&"+b):f[1]}d.getQueryString().setAt("trumbaEmbed",b)}if(j){var c=this.getProperty("closeWindowOnReturn");if(c==null||c=="true"||c==true){d.getQueryString().setAt("winClose","1")}try{var k=window.open(d.toString(),"trumbaNewWin");k.focus()}catch(o){}}else{try{window.top.location.href=d.toString()}catch(m){window.top.location=d.toString()}}}else{$Trumba.logger.info(this.getUniqueID()+" rel navigate("+b+")");this.ignoreNav=true;$Trumba.Spuds.controller.navigate(b);if(this.closed){return}this._fetchHTML(new $Trumba.Net.QueryString(b),true);if(this.getProperty("scrollTopOnNav")){window.scrollTo(0,0)}}}},getUniqueID:function(){return"("+this.id+"-"+this.spudType+")"},onNavigate:function(a){$Trumba.logger.info(this.getUniqueID()+" onNavigate("+a+")");if(this.getProperty("closeOnNav")){this.close();return}if(this.ignoreNav){this.ignoreNav=false;return}this._fetchHTML(a,false)},_navigate:function(a,b){if(a!=null){var c=this._compareQueryString(a);this.setQueryString(a);if(!c){this._fetchHTML(null,false,b)}}},_mergeQueryString:function(h,t,f){t=t||false;f=f||false;var w=new $Trumba.Net.QueryString(this.queryString);var v=new $Trumba.Net.QueryString(h);var k=$Trumba.Spuds.TransientParams.getParams(this.spudType);if(!f){var j=[];if(k!=null){w.visit(function(a){if(k[a]){j.push(a)}})}for(var r=0;r<j.length;r++){w.remove(j[r])}}for(var r=0;r<v.length();r++){var u=v.getAt(r);var y=(u[0].charAt(0)=="-")||(($Trumba.Spuds.removeList[u[0]]!=null&&!t)&&(k==null||k[u[0]]==null));if(y){if(u[0].charAt(0)=="-"){w.remove(u[0].substring(1))}else{w.remove(u[0])}}else{w.setAt(u[0],u[1])}}var c=v.getAt("objecttype");if(!c){var o=this.getProperty("objectType");if(o){w.setAt("objecttype",o)}}var s=new $Trumba.Net.QueryString(this.queryString);this.setQueryString(w);w=s;v=new $Trumba.Net.QueryString(this.queryString);var l={};for(var r=0;r<w.length();r++){var z=w.getAt(r);var g=v.findByName(z[0]);var x=g!=-1?v.getAt(g):null;if(x!=null){var m;if(this.spudType=="datefinder"&&z[0]=="date"){m=z[1].substring(0,6)==x[1].substring(0,6)||z[1]=="99901230"||z[1]=="99901231"}else{m=z[1]==x[1]}if(!m){l[z[0]]={from:z[1],to:x[1]}}}else{l[z[0]]={from:z[1],to:null}}v.removeAt(g)}for(var r=0;r<v.length();r++){var x=v.getAt(r);if(this.spudType=="datefinder"&&x[0]=="date"&&(this.pageDate.substring(0,6)==x[1].substring(0,6)||x[1]=="99901230"||x[1]=="99901231")){continue}l[x[0]]={from:null,to:x[1]}}var q=false;l.widget=null;delete l.widget;if(typeof(this.argList)!="undefined"){q=true;for(var p in l){if(typeof(this.argList[p])!="undefined"){q=false;if(!t){var d=l[p];this._fireEvent("onArgumentChanged",{name:p,oldValue:d.from,newValue:d.to})}}}}else{if(!t){for(var p in l){var d=l[p];this._fireEvent("onArgumentChanged",{name:p,oldValue:d.from,newValue:d.to})}}}return q},_compareQueryString:function(b){if(!b.pairs){return false}if(typeof(this.argList)!="undefined"){for(var a in this.argList){var d=this.queryString.getAt(a);var c=b.getAt(a);d=d==null?"":d[1];c=c==null?"":c[1];if(d!=c){return false}}return true}return false},buildPermaLink:function(){try{var j=(this.queryString.getValue("hosted")==1);var k=(this.queryString.getValue("hosted2")==1);var p=this.queryString.getValue("eventid");var m=this.queryString.getValue("seriesid");var n=this.queryString.getValue("objecttype");var h=this.queryString.getValue("objectid");var r=this.queryString.getValue("seotitle");var o=this.queryString.getValue("key");if(k){var f=window.top.location.protocol+"//"+window.top.location.host;var a=window.top.location.pathname.endsWith("/edit");if(window.top.location.pathname.startsWith("/"+this.webName)){f+="/"+this.webName}r=r||"fix-me";if(p){f+="/"+r+"/E"+p}else{if(m){f+="/"+r+"/S"+m}else{if(h){f+="/"+r+"/A"+h}}}if(o){f+="K"+o}if(a){f+="/edit"}return f+window.top.location.search}else{var d=new $Trumba.Net.Url(window.location.href);var c=d.getQueryString();var b;if(m){b=(j?"":"view=series&")+"seriesid="+m}if(p){b=(j?"":"view=event&")+"eventid="+p}if(h){b=(j?"":"view=object&")+"objectid="+h}if(j&&n&&this.spudType=="mainobject"){b="objecttype="+n+(b?("&"+b):"")}if(o){b+="&key="+o}if(j){c.from(b)}else{if(b){c.setAt("trumbaEmbed",b)}else{c.remove("trumbaEmbed")}}return d.toString()}}catch(g){console.log(g.message)}return null},updateHistory:function(a,b){if($Trumba.Spuds.controller.historyEnabled&&!b&&(this.spudType=="main"||this.spudType=="mainobject")){if(!a&&$Trumba.Spuds.controller.newNavigation){history.pushState({spudArgs:this.queryString,baseState:false},"",$Trumba.Spuds.controller.permalinksEnabled?this.buildPermaLink():null);$Trumba.Spuds.controller.newNavigation=false}}},_fetchHTML:function(a,m,j){if($Trumba.Spuds.controller.needsAuth){return}this.selfNavigate=m||false;j=j||false;var f=this.firstFetch;if(this.firstFetch){this.firstFetch=false}else{if(a){var h=this._mergeQueryString(a,false,this.selfNavigate);if(this.getProperty("noAsyncNav")){var n=new $Trumba.Net.QueryString(window.location.search);n.setAt("trumbaEmbed",this.getQueryString());window.location.search="?"+n.toString()}if(h){this.updateHistory(f,j);return}}}this.updateHistory(f,j);var g=new $Trumba.Net.QueryString(this.queryString);var c=this.getProperty("styleSheets");if(c&&c.length){g.setAt("ssOverrides",1)}var l=this.getProperty("navigateHandler");if(!f&&l&&typeof l=="function"){if(l(g,this.selfNavigate)){return}}var k=this.getProperty("position");if(this.container._loaded||k!=null){if(k!=null){this._showBusyImage(k)}else{var d=this.container.getLocation();var b=this.getProperty("busyImageOffsetTop");if(b){d.top+=b;this.setProperty("busyImageOffsetTop",null)}this._showBusyImage(d)}}this.container.fetch(g)},_setLoadingHTML:function(){var a="";try{if(this.parentDiv.currentStyle){var d=this.parentDiv;while(d&&d.currentStyle){a=d.currentStyle.backgroundColor;if(a=="transparent"){d=d.parentNode}else{break}}}else{if(window.getComputedStyle){a=window.getComputedStyle(this.parentDiv,null).backgroundColor}}}catch(c){$Trumba.logger.error("RIP getting background color!",c,"$Trumba.Spuds.SimpleSpud","_setLoadingHTML")}if(a.length){a=$Trumba.String.format("background-color:{0};",a)}var b=$Trumba.String.format('<div style="{0}margin:0px;padding:0px;font-size:0.8em;font-family:Arial, Helvetica, Verdana;font-style:italic;"><img src="',a)+$Trumba.baseUri+'images/spinner.gif" width="16" height="16" style="width:16px;height:16px;border-width:0;margin:0">&nbsp;&nbsp;Loading&nbsp;.&nbsp;.&nbsp;.</div>';this.container.setHTML(b,true);this.container.resize()},_getBusyImageId:function(){return this.id+".busy"},_showBusyImage:function(c){var b=this.getProperty("hideBusyImage")||false;if(!b){var a=$Trumba.DOM.createElement("img",[["id",this._getBusyImageId()]]);a.style.position="absolute";a.style.left=c.left+"px";a.style.top=c.top+"px";a.style.width="16px";a.style.height="16px";a.style.borderWidth="0";a.style.margin="0";a.style.zIndex=100000;a.src=$Trumba.busyImageUri;document.body.appendChild(a);$Trumba.logger.info(this._getBusyImageId()+", parent:"+a.parentNode.tagName,null,"$Trumba.Spuds.SimpleSpud","_showBusyImage")}},_hideBusyImage:function(){var a=$Trumba.$(this._getBusyImageId());if(a){$Trumba.logger.info(this._getBusyImageId()+", parent:"+a.parentNode.tagName,null,"$Trumba.Spuds.SimpleSpud","_hideBusyImage");a.parentNode.removeChild(a)}}};$Trumba.Class.extend($Trumba.Spuds.SimpleSpud.prototype,$Trumba.EventSource);$Trumba.Spuds.PopUpBehavior=$Trumba.Class.create();$Trumba.Spuds.PopUpBehavior.prototype={initialize:function(a,f,b){this._spud=a;if(f){this._makeKeyHandler(window.document);var c=$Trumba.Spuds.controller.getSpuds();for(var d=0;d<c.length;d++){this._makeKeyHandler(c[d].container.getWindow().document)}}if(b){this._makeClickHandler(window.document);var c=$Trumba.Spuds.controller.getSpuds();for(var d=0;d<c.length;d++){if(c[d]==a){continue}this._makeClickHandler(c[d].container.getWindow().document)}}},_makeKeyHandler:function(a){this._makeHandler(a,"keypress",function(b){if($Trumba.Event.keyCode(b)==$Trumba.Event.KEY_ESC){this.spud.close();this.stop(true)}},false)},_makeClickHandler:function(a){this._makeHandler(a,"click",function(b){this.spud.close();this.stopObserving()},false)},_makeHandler:function(f,d,b,a){var c=$Trumba.$A(arguments);c.shift();c.shift();c.shift();c.shift();var g={onEvent:function(h){this._event=h||window.event;c=[];c.push(this._event);return this.observer.apply(this,c.concat(this.args))},stop:function(h){$Trumba.Event.stop(this._event);if(h){this.stopObserving()}},stopObserving:function(){$Trumba.Event.stopObserving(this.element,this.name,this.boundObserver,this.capture)},element:f,name:d,observer:b,capture:a,boundObserver:null,args:c};this._spud.addEventListener("close",g.stopObserving.$trumba_bind(g));g.spud=this._spud;g.boundObserver=g.onEvent.$trumba_bind(g);$Trumba.Event.observe(g.element,g.name,g.boundObserver,g.capture)}};$Trumba.Spuds.Loader=$Trumba.Class.create();$Trumba.Spuds.Loader.prototype={initialize:function(){},request:function(f,c,b){b=$Trumba.Class.extend({id:null,replace:true,delay:0.001},b||{});var a=$Trumba.loaderUri+"?"+f;$Trumba.logger.info("Loading "+a,null,"$Trumba.Spuds.Loader","request");var d=new XMLHttpRequest();d.open("GET",a+"&spudformat=xhr",true);d.timeout=60000;d.withCredentials=true;d.onload=function(){if(d.status===200){c.onSuccess(d.responseText)}else{c.onFailure()}};d.onerror=c.onFailure;d.ontimeout=c.onTimeout;if($Trumba.Spuds.controller.authCode){d.setRequestHeader("ea-auth",$Trumba.Spuds.controller.authCode)}d.send()}};$Trumba.Spuds.PageController=$Trumba.Class.create();$Trumba.Spuds.PageController.prototype={initialize:function(){this.spuds={};this.loader=new $Trumba.Spuds.Loader();this.needsAuth=false;var a=this;$Trumba.Event.observe(window,"resize",function(){a.resize()},false)},getHostWindow:function(){return window},getSpudById:function(a){return this.spuds[a]},addHead:function(a,b){var c=document.getElementsByTagName("head");if(c.length){var d=$Trumba.DOM.createElement(a,b);$Trumba.DOM.appendChild(d,c[0])}},navigate:function(a){if(typeof(a)=="string"){a=new $Trumba.Net.QueryString(a)}this._fireEvent("navigate",a);$Trumba.Spuds.controller.newNavigation=true;for(var b in this.spuds){if(this.spuds[b].onNavigate){this.spuds[b].onNavigate(a)}}},navigateBack:function(){if(window.location.hash==""||window.location.hash=="#"){var b=new $Trumba.Net.QueryString(window.location.search);if(b.getAt("winClose")){try{window.opener.focus()}catch(c){}try{window.close()}catch(c){}return}var a=b.getAt("trumbaEmbed");if(a&&a[1]){b=new $Trumba.Net.QueryString(a[1]);a=b.getAt("returnUrl")}if(a&&a[1]){try{history.back()}catch(c){window.top.location.href=a[1]}return}}if(this.historyEnabled&&typeof history.state!="undefined"&&history.state!=null&&!history.state.baseState){history.back()}else{$Trumba.Spuds.controller.navigate("-view=&-eventid=&-parenteventid=&-seriesid=&-objectid=&-childview&-seotitle=")}},navigateHistory:function(c){if(c.state&&c.state.spudArgs){var a=new $Trumba.Net.QueryString();a.pairs=c.state.spudArgs.pairs;for(var b in $Trumba.Spuds.controller.spuds){if($Trumba.Spuds.controller.spuds[b]._navigate){$Trumba.Spuds.controller.spuds[b]._navigate(a,true)}}}},setupHistory:function(a,c,g){if(history.replaceState&&history.pushState&&window.onpopstate==null){if(!this.historySetup){this.historySetup=true;var f=c;if(typeof TrumbaDisableBrowserHistory!="undefined"&&TrumbaDisableBrowserHistory){f=false}var b=a.getProperty("history");if(b!=null){f=b}if(f){this.historyEnabled=history.state==null||typeof history.state.webName!="undefined"||typeof history.state.spudArgs!="undefined";if(this.historyEnabled){if(window.addEventListener){window.addEventListener("popstate",$Trumba.Spuds.controller.navigateHistory)}else{window.onpopstate=$Trumba.Spuds.controller.navigateHistory}}if(this.historyEnabled&&history.state==null||history.state.domainName){history.replaceState({spudArgs:a.queryString,baseState:true},"")}}var d=a.getProperty("historyPermalinks");if(d!=null){this.permalinksEnabled=d}else{this.permalinksEnabled=g}}}else{this.historyEnabled=false}},addSpud:function(a){if(this.spuds[a.id]==null){this.spuds[a.id]=a;a.refresh()}},removeSpud:function(a){if(this.spuds[a.id]!=null){this.spuds[a.id]=null;delete this.spuds[a.id]}},getSpud:function(a){for(var b in this.spuds){if(this.spuds[b].getIFrameId&&this.spuds[b].getIFrameId()==a){return this.spuds[b]}}return null},getSpuds:function(){var a=[];for(var b in this.spuds){if(this.spuds[b].getIFrameId){a.push(this.spuds[b])}}return a},refresh:function(){for(var a in this.spuds){if(this.spuds[a].refresh){this.spuds[a].refresh()}}},hideBusyImages:function(){for(var a in this.spuds){if(this.spuds[a]._hideBusyImage){this.spuds[a]._hideBusyImage()}}},resize:function(){var a=0;for(var b in this.spuds){if(this.spuds[b].resize){this.spuds[b].resize()}}},findSpud:function(f,d){var b=this.getSpuds();for(var c=0;c<b.length;c++){var a=b[c].getProperty(f);if(a&&a==d){return b[c]}}return null},promptForPassword:function(b){$Trumba.logger.error("Prompting!");var a=this;$Trumba.Event.observe(window,"focus",function(){$Trumba.logger.error("Focus!");$Trumba.Event.stopObserving(window,"focus",arguments.callee,false);a.refresh()},false);window.open(b,"trumba_embedLogin","width=750,height=325,scrollbars=1,status=1,resizable=yes,toolbar=no,menubar=no")}};$Trumba.Class.extend($Trumba.Spuds.PageController.prototype,$Trumba.EventSource);$Trumba.Spuds.controller=new $Trumba.Spuds.PageController();$Trumba.Spuds.controller.baseUri=$Trumba.baseUri;function SizeTrumbaFrame(a){}if(typeof(trumba_preSpudsJS)!="undefined"){$Trumba.logger.warning($Trumba.String.format("spuds.js took {0} seconds to download.",($Trumba.loadTime-trumba_preSpudsJS)/1000))}for(var i=0;i<$Trumba.prologQueue.length;i++){$Trumba.prologQueue[i]()}$Trumba.prologQueue=[];try{$Trumba.Spuds.controller.defaultTitle=window.parent.document.title}catch(e){$Trumba.Spuds.controller.defaultTitle=null}$Trumba.checkAuth=function(){var b=new $Trumba.Net.Url(location);var a=b.getQueryString();var f=a.getAt("trumbaAC");if(f!=null&&f.length>1){var c=f[1];a.remove("trumbaAC");if(history.replaceState){if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){location.hash=location.hash}history.replaceState(null,"",b.toString())}$Trumba.Spuds.controller.needsAuth=true;if($Trumba.baseUri.indexOf("http:")==0){alert("Page must be loaded https");return}var d=new XMLHttpRequest();d.open("POST",$Trumba.baseUri+"api/auth/token",true);d.timeout=60000;d.withCredentials=true;d.onload=function(){if(d.status===200){$Trumba.Spuds.controller.authCode=JSON.parse(d.responseText);$Trumba.Spuds.controller.needsAuth=false;$Trumba.Spuds.controller.refresh()}else{$Trumba.Spuds.controller.hideBusyImages();var g=d.responseText?JSON.parse(d.responseText):null;if(g&&g.Message){alert(g.Message)}else{alert("Error retreiving auth token")}}};d.onerror=function(){$Trumba.Spuds.controller.hideBusyImages();alert("Error retreiving auth token")};d.ontimeout=function(){$Trumba.Spuds.controller.hideBusyImages();alert("Timeout retreiving auth token")};d.setRequestHeader("Content-Type","application/json");d.send('"'+c+'"')}};$Trumba.checkAuth()};